

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>turbo.websocket – WebSocket server and client &mdash; Turbo.lua 2.0.0 documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Roboto+Slab:400,700|Inconsolata:400,700&subset=latin,cyrillic' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="Turbo.lua 2.0.0 documentation" href="index.html"/>
        <link rel="next" title="turbo.ioloop – Main I/O Loop" href="ioloop.html"/>
        <link rel="prev" title="turbo.async – Asynchronous clients" href="async.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        
          <a href="index.html" class="fa fa-home"> Turbo.lua</a>
        
        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul>
<li class="toctree-l1"><a class="reference internal" href="get_started.html">Get Started With Turbo</a><ul>
<li class="toctree-l2"><a class="reference internal" href="get_started.html#installing-turbo">Installing Turbo</a></li>
<li class="toctree-l2"><a class="reference internal" href="get_started.html#hello-world">Hello World</a></li>
<li class="toctree-l2"><a class="reference internal" href="get_started.html#request-parameters">Request parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="get_started.html#routes">Routes</a></li>
<li class="toctree-l2"><a class="reference internal" href="get_started.html#serving-static-files">Serving Static Files</a></li>
<li class="toctree-l2"><a class="reference internal" href="get_started.html#json-output">JSON Output</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="modules.html">Asynchronous modules</a><ul>
<li class="toctree-l2"><a class="reference internal" href="modules.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="modules.html#example-module">Example module</a></li>
</ul>
</li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="apiref.html">Turbo.lua API Versioning</a><ul>
<li class="toctree-l2"><a class="reference internal" href="apiref.html#preliminaries">Preliminaries</a></li>
<li class="toctree-l2"><a class="reference internal" href="apiref.html#module-version">Module Version</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="web.html">turbo.web &#8211; Core web framework</a><ul>
<li class="toctree-l2"><a class="reference internal" href="web.html#requesthandler-class">RequestHandler class</a></li>
<li class="toctree-l2"><a class="reference internal" href="web.html#httperror-class">HTTPError class</a></li>
<li class="toctree-l2"><a class="reference internal" href="web.html#staticfilehandler-class">StaticFileHandler class</a></li>
<li class="toctree-l2"><a class="reference internal" href="web.html#redirecthandler-class">RedirectHandler class</a></li>
<li class="toctree-l2"><a class="reference internal" href="web.html#application-class">Application class</a></li>
<li class="toctree-l2"><a class="reference internal" href="web.html#mustache-templating">Mustache Templating</a></li>
<li class="toctree-l2"><a class="reference internal" href="web.html#mustache-templatehelper-class">Mustache.TemplateHelper class</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="async.html">turbo.async &#8211; Asynchronous clients</a><ul>
<li class="toctree-l2"><a class="reference internal" href="async.html#utilities-for-coroutines">Utilities for coroutines</a></li>
<li class="toctree-l2"><a class="reference internal" href="async.html#httpclient-class">HTTPClient class</a></li>
<li class="toctree-l2"><a class="reference internal" href="async.html#httpresponse-class">HTTPResponse class</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="">turbo.websocket &#8211; WebSocket server and client</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#websocketstream-mixin">WebSocketStream mixin</a></li>
<li class="toctree-l2"><a class="reference internal" href="#websockethandler-class">WebSocketHandler class</a></li>
<li class="toctree-l2"><a class="reference internal" href="#websocketclient-class">WebSocketClient class</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="ioloop.html">turbo.ioloop &#8211; Main I/O Loop</a><ul>
<li class="toctree-l2"><a class="reference internal" href="ioloop.html#ioloop-class">IOLoop class</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="iostream.html">turbo.iostream &#8211; High-level asynchronous streaming sockets</a><ul>
<li class="toctree-l2"><a class="reference internal" href="iostream.html#iostream-class">IOStream class</a></li>
<li class="toctree-l2"><a class="reference internal" href="iostream.html#ssliostream-class">SSLIOStream class</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="httputil.html">turbo.httputil &#8211; Utilities for the HTTP protocol</a><ul>
<li class="toctree-l2"><a class="reference internal" href="httputil.html#httpparser-class">HTTPParser class</a></li>
<li class="toctree-l2"><a class="reference internal" href="httputil.html#httpheaders-class">HTTPHeaders class</a></li>
<li class="toctree-l2"><a class="reference internal" href="httputil.html#functions">Functions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="httpserver.html">turbo.httpserver &#8211; Callback based HTTP Server</a><ul>
<li class="toctree-l2"><a class="reference internal" href="httpserver.html#httpserver-class">HTTPServer class</a></li>
<li class="toctree-l2"><a class="reference internal" href="httpserver.html#httprequest-class">HTTPRequest class</a></li>
<li class="toctree-l2"><a class="reference internal" href="httpserver.html#httpconnection-class">HTTPConnection class</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="tcpserver.html">turbo.tcpserver &#8211; Callback based TCP socket Server</a><ul>
<li class="toctree-l2"><a class="reference internal" href="tcpserver.html#tcpserver-class">TCPServer class</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="structs.html">turbo.structs &#8211; Data structures</a><ul>
<li class="toctree-l2"><a class="reference internal" href="structs.html#deque-double-ended-queue">deque, Double ended queue</a></li>
<li class="toctree-l2"><a class="reference internal" href="structs.html#buffer-low-level-mutable-buffer">buffer, Low-level mutable buffer</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="hash.html">turbo.hash &#8211; Cryptographic Hashes</a><ul>
<li class="toctree-l2"><a class="reference internal" href="hash.html#sha1-class">SHA1 class</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="util.html">turbo.util Common utilities</a><ul>
<li class="toctree-l2"><a class="reference internal" href="util.html#table-tools">Table tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="util.html#low-level">Low level</a></li>
<li class="toctree-l2"><a class="reference internal" href="util.html#misc">Misc</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="sockutil.html">turbo.sockutil &#8211; Socket utilites and helpers</a></li>
<li class="toctree-l1"><a class="reference internal" href="escape.html">turbo.escape &#8211; Escaping and JSON utilities</a><ul>
<li class="toctree-l2"><a class="reference internal" href="escape.html#json-conversion">JSON conversion</a></li>
<li class="toctree-l2"><a class="reference internal" href="escape.html#escaping">Escaping</a></li>
<li class="toctree-l2"><a class="reference internal" href="escape.html#string-trimming">String trimming</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="log.html">turbo.log &#8211; Command-line log helper</a></li>
<li class="toctree-l1"><a class="reference internal" href="turbovisor.html">turbovisor &#8211; Application supervisor</a><ul>
<li class="toctree-l2"><a class="reference internal" href="turbovisor.html#options">Options</a></li>
<li class="toctree-l2"><a class="reference internal" href="turbovisor.html#examples">Examples</a></li>
</ul>
</li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">Turbo.lua</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>turbo.websocket &#8211; WebSocket server and client</li>
      <li class="wy-breadcrumbs-aside">
        
          <a href="_sources/websocket.txt" rel="nofollow"> View page source</a>
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <div class="section" id="turbo-websocket-websocket-server-and-client">
<span id="websocket"></span><h1>turbo.websocket &#8211; WebSocket server and client<a class="headerlink" href="#turbo-websocket-websocket-server-and-client" title="Permalink to this headline">¶</a></h1>
<p>The WebSocket modules extends Turbo and offers RFC 6455 compliant WebSocket
support.</p>
<p>The module offers two classes:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">turbo.websocket.WebSocketHandler</span></tt>, WebSocket support for <tt class="docutils literal"><span class="pre">turbo.web.Application</span></tt>.</li>
<li><tt class="docutils literal"><span class="pre">turbo.websocket.WebSocketClient</span></tt>, callback based WebSocket client.</li>
</ul>
<p>Both classes uses the mixin class <tt class="docutils literal"><span class="pre">turbo.websocket.WebSocketStream</span></tt>, which in
turn provides almost identical API&#8217;s for the two classes once connected. Both
classes support SSL (wss://).</p>
<p><em>NOTICE: _G.TURBO_SSL MUST be set to true and OpenSSL or axTLS MUST be
installed to use this module as certain hash functions are required by the
WebSocket protocol.</em></p>
<p>A simple example subclassing <tt class="docutils literal"><span class="pre">turbo.websocket.WebSocketHandler</span></tt>.:</p>
<div class="highlight-lua"><div class="highlight"><pre><span class="n">_G</span><span class="p">.</span><span class="n">TURBO_SSL</span> <span class="o">=</span> <span class="kc">true</span>
<span class="kd">local</span> <span class="n">turbo</span> <span class="o">=</span> <span class="nb">require</span> <span class="s2">&quot;</span><span class="s">turbo&quot;</span>

<span class="kd">local</span> <span class="n">WSExHandler</span> <span class="o">=</span> <span class="n">class</span><span class="p">(</span><span class="s2">&quot;</span><span class="s">WSExHandler&quot;</span><span class="p">,</span> <span class="n">turbo</span><span class="p">.</span><span class="n">websocket</span><span class="p">.</span><span class="n">WebSocketHandler</span><span class="p">)</span>

<span class="k">function</span> <span class="nf">WSExHandler</span><span class="p">:</span><span class="n">on_message</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="n">self</span><span class="p">:</span><span class="n">write_message</span><span class="p">(</span><span class="s2">&quot;</span><span class="s">Hello World.&quot;</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">turbo</span><span class="p">.</span><span class="n">web</span><span class="p">.</span><span class="n">Application</span><span class="p">({{</span><span class="s2">&quot;</span><span class="s">^/ws$&quot;</span><span class="p">,</span> <span class="n">WSExHandler</span><span class="p">}}):</span><span class="n">listen</span><span class="p">(</span><span class="mi">8888</span><span class="p">)</span>
<span class="n">turbo</span><span class="p">.</span><span class="n">ioloop</span><span class="p">.</span><span class="n">instance</span><span class="p">():</span><span class="n">start</span><span class="p">()</span>
</pre></div>
</div>
<div class="section" id="websocketstream-mixin">
<h2>WebSocketStream mixin<a class="headerlink" href="#websocketstream-mixin" title="Permalink to this headline">¶</a></h2>
<p>WebSocketStream is a abstraction for a WebSocket connection, used as class mixin
in <tt class="docutils literal"><span class="pre">turbo.websocket.WebSocketHandler</span></tt> and <tt class="docutils literal"><span class="pre">turbo.websocket.WebSocketClient</span></tt>.</p>
<dl class="function">
<dt>
<tt class="descname">WebSocketStream:write_message(msg, binary)</tt></dt>
<dd><p>Send a message to the client of the active Websocket. If the stream has been
closed a error is raised.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>msg</strong> (<em>String</em>) &#8211; The message to send. This may be either a JSON-serializable table or a string.</li>
<li><strong>binary</strong> (<em>Boolean</em>) &#8211; Treat the message as binary data (use WebSocket binary opcode).</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt>
<tt class="descname">WebSocketStream:ping(data, callback, callback_arg)</tt></dt>
<dd><p>Send a ping to the connected client.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>data</strong> (<em>String</em>) &#8211; Data to pong back.</li>
<li><strong>callback</strong> (<em>Function</em>) &#8211; Function to call when pong is recieved.</li>
<li><strong>callback_arg</strong> &#8211; Argument for callback function.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt>
<tt class="descname">WebSocketStream:pong(data)</tt></dt>
<dd><p>Send a pong to the connected server.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>data</strong> (<em>String</em>) &#8211; Data to pong back.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt>
<tt class="descname">WebSocketStream:close()</tt></dt>
<dd><p>Close the connection.</p>
</dd></dl>

<dl class="function">
<dt>
<tt class="descname">WebSocketStream:closed()</tt></dt>
<dd><p>Has the stream been closed?</p>
</dd></dl>

</div>
<div class="section" id="websockethandler-class">
<h2>WebSocketHandler class<a class="headerlink" href="#websockethandler-class" title="Permalink to this headline">¶</a></h2>
<p>The WebSocketHandler is a subclass of <tt class="docutils literal"><span class="pre">turbo.web.RequestHandler</span></tt>.
So most of the methods and attributes of that class are available. However, some
of them will not work with WebSocket&#8217;s. It also have the mixin class
<tt class="docutils literal"><span class="pre">turbo.websocket.WebSocketStream</span></tt> included. Only the official WebSocket
specification, RFC 6455, is supported.</p>
<p>For a more thorough example of usage of this class you can review the &#8220;chatapp&#8221;
example bundled with Turbo, which uses most of its features to create a simple
Web-based chat app.</p>
<p><em>Subclass WebSocketHandler and implement any of the following methods to handle
the corresponding events.</em></p>
<dl class="function">
<dt>
<tt class="descname">WebSocketHandler:open()</tt></dt>
<dd><p>Called when a new WebSocket request is opened.</p>
</dd></dl>

<dl class="function">
<dt>
<tt class="descname">WebSocketHandler:on_message(msg)</tt></dt>
<dd><p>Called when a message is recieved.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>msg</strong> (<em>String</em>) &#8211; The recieved message.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt>
<tt class="descname">WebSocketHandler:on_close()</tt></dt>
<dd><p>Called when the connection is closed.</p>
</dd></dl>

<dl class="function">
<dt>
<tt class="descname">WebSocketHandler:on_error(msg)</tt></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>msg</strong> (<em>String</em>) &#8211; A error string.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt>
<tt class="descname">WebSocketHandler:prepare()</tt></dt>
<dd><p>Called when the headers has been parsed and the server is about to initiate
the WebSocket specific handshake. Use this to e.g check if the headers
Origin field matches what you expect. To abort the connection you raise a
error. <tt class="docutils literal"><span class="pre">turbo.web.HTTPError</span></tt> is the most convinient as you can set error
code and a message returned to the client.</p>
</dd></dl>

<dl class="function">
<dt>
<tt class="descname">WebSocketHandler:subprotocol(protocols)</tt></dt>
<dd><p>Called if the client have included a Sec-WebSocket-Protocol field
in header. This method will then recieve a table of protocols that
the clients wants to use. If this field is not set, this method will
never be called. The return value of this method should be a string
which matches one of the suggested protcols in its parameter.
If all of the suggested protocols are unacceptable then dismissing of
the request is done by either raising error
(such as <tt class="docutils literal"><span class="pre">turbo.web.HTTPError</span></tt>) or returning nil.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>protocols</strong> (<em>Table of protocol name strings.</em>) &#8211; The protocol names recieved from client.</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<div class="section" id="websocketclient-class">
<h2>WebSocketClient class<a class="headerlink" href="#websocketclient-class" title="Permalink to this headline">¶</a></h2>
<p>A async callback based WebSocket client. Only the official WebSocket
specification, RFC 6455, is supported. The WebSocketClient is partly based
on the <tt class="docutils literal"><span class="pre">turbo.async.HTTPClient</span></tt> using its HTTP implementation to do the initial
connect to the server, then do the handshake and finally wrapping the connection
with the <tt class="docutils literal"><span class="pre">turbo.websocket.WebSocketStream</span></tt>. All of the callback functions
recieves the class instance as first argument for convinence. Furthermore the
class can be initialized with keyword arguments that are passed on to the
<tt class="docutils literal"><span class="pre">turbo.async.HTTPClient</span></tt> that are being used. So if you are going to use
the connect to a SSL enabled server (wss://) then you simply refer to the documentation
of the HTTPClient and set &#8220;priv_file&#8221;, &#8220;cert_file&#8221; keys properly.
Some arguments are discared though, such as e.g &#8220;method&#8221;.</p>
<p>A simple usage example of <tt class="docutils literal"><span class="pre">turbo.websocket.WebSocketClient</span></tt>.:</p>
<div class="highlight-lua"><div class="highlight"><pre><span class="n">_G</span><span class="p">.</span><span class="n">TURBO_SSL</span> <span class="o">=</span> <span class="kc">true</span> <span class="c1">-- SSL must be enabled for WebSocket support!</span>
<span class="kd">local</span> <span class="n">turbo</span> <span class="o">=</span> <span class="nb">require</span> <span class="s2">&quot;</span><span class="s">turbo&quot;</span>

<span class="n">turbo</span><span class="p">.</span><span class="n">ioloop</span><span class="p">.</span><span class="n">instance</span><span class="p">():</span><span class="n">add_callback</span><span class="p">(</span><span class="k">function</span><span class="p">()</span>
    <span class="n">turbo</span><span class="p">.</span><span class="n">websocket</span><span class="p">.</span><span class="n">WebSocketClient</span><span class="p">(</span><span class="s2">&quot;</span><span class="s">ws://127.0.0.1:8888/ws&quot;</span><span class="p">,</span> <span class="p">{</span>
        <span class="n">on_headers</span> <span class="o">=</span> <span class="k">function</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">headers</span><span class="p">)</span>
            <span class="c1">-- Review headers recieved from the WebSocket server.</span>
            <span class="c1">-- You can e.g drop the request if the response headers</span>
            <span class="c1">-- are not satisfactory with self:close().</span>
        <span class="k">end</span><span class="p">,</span>
        <span class="n">modify_headers</span> <span class="o">=</span> <span class="k">function</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">headers</span><span class="p">)</span>
            <span class="c1">-- Modify outgoing headers before they are sent.</span>
            <span class="c1">-- headers parameter are a instance of httputil.HTTPHeader.</span>
        <span class="k">end</span><span class="p">,</span>
        <span class="n">on_connect</span> <span class="o">=</span> <span class="k">function</span><span class="p">(</span><span class="n">self</span><span class="p">)</span>
            <span class="c1">-- Called when the client has successfully opened a WebSocket</span>
            <span class="c1">-- connection to the server.</span>
            <span class="c1">-- When the connection is established you can write a message:</span>
            <span class="n">self</span><span class="p">:</span><span class="n">write_message</span><span class="p">(</span><span class="s2">&quot;</span><span class="s">Hello World!&quot;</span><span class="p">)</span>
        <span class="k">end</span><span class="p">,</span>
        <span class="n">on_message</span> <span class="o">=</span> <span class="k">function</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
            <span class="c1">-- Print the incoming message.</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="n">self</span><span class="p">:</span><span class="n">close</span><span class="p">()</span>
        <span class="k">end</span><span class="p">,</span>
        <span class="n">on_close</span> <span class="o">=</span> <span class="k">function</span><span class="p">(</span><span class="n">self</span><span class="p">)</span>
            <span class="c1">-- I am called when connection is closed. Both gracefully and</span>
            <span class="c1">-- not gracefully.</span>
        <span class="k">end</span><span class="p">,</span>
        <span class="n">on_error</span> <span class="o">=</span> <span class="k">function</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="n">reason</span><span class="p">)</span>
            <span class="c1">-- I am called whenever there is a error with the WebSocket.</span>
            <span class="c1">-- code are defined in ``turbo.websocket.errors``. reason are</span>
            <span class="c1">-- a string representation of the same error.</span>
        <span class="k">end</span>
    <span class="p">})</span>
<span class="k">end</span><span class="p">):</span><span class="n">start</span><span class="p">()</span>
</pre></div>
</div>
<p>WebSocketClient uses error codes to report failure for the <tt class="docutils literal"><span class="pre">on_error</span></tt> callback.</p>
<dl class="attribute">
<dt id="errors">
<tt class="descname">errors</tt><a class="headerlink" href="#errors" title="Permalink to this definition">¶</a></dt>
<dd><p>Numeric error codes set as first argument of <tt class="docutils literal"><span class="pre">on_error</span></tt>:</p>
<blockquote>
<div><p><tt class="docutils literal"><span class="pre">INVALID_URL</span></tt>            - URL could not be parsed.</p>
<p><tt class="docutils literal"><span class="pre">INVALID_SCHEMA</span></tt>         - Invalid URL schema</p>
<p><tt class="docutils literal"><span class="pre">COULD_NOT_CONNECT</span></tt>      - Could not connect, check message.</p>
<p><tt class="docutils literal"><span class="pre">PARSE_ERROR_HEADERS</span></tt>    - Could not parse response headers.</p>
<p><tt class="docutils literal"><span class="pre">CONNECT_TIMEOUT</span></tt>        - Connect timed out.</p>
<p><tt class="docutils literal"><span class="pre">REQUEST_TIMEOUT</span></tt>        - Request timed out.</p>
<p><tt class="docutils literal"><span class="pre">NO_HEADERS</span></tt>             - Shouldn&#8217;t happen.</p>
<p><tt class="docutils literal"><span class="pre">REQUIRES_BODY</span></tt>          - Expected a HTTP body, but none set.</p>
<p><tt class="docutils literal"><span class="pre">INVALID_BODY</span></tt>           - Request body is not a string.</p>
<p><tt class="docutils literal"><span class="pre">SOCKET_ERROR</span></tt>           - Socket error, check message.</p>
<p><tt class="docutils literal"><span class="pre">SSL_ERROR</span></tt>              - SSL error, check message.</p>
<p><tt class="docutils literal"><span class="pre">BUSY</span></tt>                       - Operation in progress.</p>
<p><tt class="docutils literal"><span class="pre">REDIRECT_MAX</span></tt>               - Redirect maximum reached.</p>
<p><tt class="docutils literal"><span class="pre">CALLBACK_ERROR</span></tt>         - Error in callback.</p>
<p><tt class="docutils literal"><span class="pre">BAD_HTTP_STATUS</span></tt>        - Did not recieve expected 101 Upgrade.</p>
<p><tt class="docutils literal"><span class="pre">WEBSOCKET_PROTOCOL_ERROR</span></tt>  - Invalid WebSocket protocol data recieved.</p>
</div></blockquote>
</dd></dl>

<dl class="function">
<dt>
<tt class="descname">WebSocketClient(address, kwargs):</tt></dt>
<dd><p>Create a new WebSocketClient class instance.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>address</strong> (<em>String</em>) &#8211; URL for WebSocket server to connect to.</li>
<li><strong>kwargs</strong> (<em>Table</em>) &#8211; Optional keyword arguments.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">Instance of <tt class="docutils literal"><span class="pre">turbo.websocket.WebSocketClient</span></tt></p>
</td>
</tr>
</tbody>
</table>
<p>Available keyword arguments:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">params</span></tt> - Provide parameters as table.</li>
<li><tt class="docutils literal"><span class="pre">cookie</span></tt> - The cookie to use.</li>
<li><tt class="docutils literal"><span class="pre">allow_redirects</span></tt> - Allow or disallow redirects. Default is true.</li>
<li><tt class="docutils literal"><span class="pre">max_redirects</span></tt> - Maximum redirections allowed. Default is 4.</li>
<li><tt class="docutils literal"><span class="pre">body</span></tt> - Request HTTP body in plain form.</li>
<li><tt class="docutils literal"><span class="pre">request_timeout</span></tt> - Total timeout in seconds (including connect) for request. Default is 60 seconds. After the connection has been established the timeout is removed.</li>
<li><tt class="docutils literal"><span class="pre">connect_timeout</span></tt> - Timeout in seconds for connect. Default is 20 secs.</li>
<li><tt class="docutils literal"><span class="pre">auth_username</span></tt> - Basic Auth user name.</li>
<li><tt class="docutils literal"><span class="pre">auth_password</span></tt> - Basic Auth password.</li>
<li><tt class="docutils literal"><span class="pre">user_agent</span></tt> - User Agent string used in request headers. Default is <tt class="docutils literal"><span class="pre">Turbo</span> <span class="pre">Client</span> <span class="pre">vx.x.x</span></tt>.</li>
<li><tt class="docutils literal"><span class="pre">priv_file</span></tt> - Path to SSL / HTTPS private key file.</li>
<li><tt class="docutils literal"><span class="pre">cert_file</span></tt> - Path to SSL / HTTPS certificate key file.</li>
<li><tt class="docutils literal"><span class="pre">ca_path</span></tt> - Path to SSL / HTTPS CA certificate verify location, if not given builtin is used, which is copied from Ubuntu 12.10.</li>
<li><tt class="docutils literal"><span class="pre">verify_ca</span></tt> - SSL / HTTPS verify servers certificate. Default is true.</li>
</ul>
</dd></dl>

<div class="section" id="description-of-the-callback-functions">
<h3>Description of the callback functions<a class="headerlink" href="#description-of-the-callback-functions" title="Permalink to this headline">¶</a></h3>
<dl class="function">
<dt id="modify_headers">
<tt class="descname">modify_headers</tt><big>(</big><em>self</em>, <em>headers</em><big>)</big><a class="headerlink" href="#modify_headers" title="Permalink to this definition">¶</a></dt>
<dd><p>Modify OUTGOING HTTP headers before they are sent to the server.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>self</strong> (<em>turbo.websocket.WebSocketClient</em>) &#8211; The WebSocketClient instance calling the callback.</li>
<li><strong>headers</strong> (<tt class="docutils literal"><span class="pre">turbo.httputil.HTTPHeader</span></tt>) &#8211; Headers ready to be sent and possibly modified.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="on_headers">
<tt class="descname">on_headers</tt><big>(</big><em>self</em>, <em>headers</em><big>)</big><a class="headerlink" href="#on_headers" title="Permalink to this definition">¶</a></dt>
<dd><p>Review HTTP headers recieved from the WebSocket server.
You can e.g drop the request if the response headers
are not satisfactory with self:close().</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>self</strong> (<em>turbo.websocket.WebSocketClient</em>) &#8211; The WebSocketClient instance calling the callback.</li>
<li><strong>headers</strong> (<tt class="docutils literal"><span class="pre">turbo.httputil.HTTPHeader</span></tt>) &#8211; Headers recieved from the client.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="on_connect">
<tt class="descname">on_connect</tt><big>(</big><em>self</em><big>)</big><a class="headerlink" href="#on_connect" title="Permalink to this definition">¶</a></dt>
<dd><p>Called when the client has successfully opened a WebSocket
connection to the server.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>self</strong> (<em>turbo.websocket.WebSocketClient</em>) &#8211; The WebSocketClient instance calling the callback.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="on_message">
<tt class="descname">on_message</tt><big>(</big><em>self</em>, <em>msg</em><big>)</big><a class="headerlink" href="#on_message" title="Permalink to this definition">¶</a></dt>
<dd><p>Called when a message is recieved.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>self</strong> (<em>turbo.websocket.WebSocketClient</em>) &#8211; The WebSocketClient instance calling the callback.</li>
<li><strong>msg</strong> (<em>String</em>) &#8211; The message or binary data.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="on_close">
<tt class="descname">on_close</tt><big>(</big><em>self</em><big>)</big><a class="headerlink" href="#on_close" title="Permalink to this definition">¶</a></dt>
<dd><p>Called when connection is closed. Both gracefully and
not gracefully.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>self</strong> (<em>turbo.websocket.WebSocketClient</em>) &#8211; The WebSocketClient instance calling the callback.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="on_error">
<tt class="descname">on_error</tt><big>(</big><em>self</em>, <em>code</em>, <em>reason</em><big>)</big><a class="headerlink" href="#on_error" title="Permalink to this definition">¶</a></dt>
<dd><p>Called whenever there is a error with the WebSocket.
code are defined in <tt class="docutils literal"><span class="pre">turbo.websocket.errors</span></tt>. reason are
a string representation of the same error.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>self</strong> (<em>turbo.websocket.WebSocketClient</em>) &#8211; The WebSocketClient instance calling the callback.</li>
<li><strong>code</strong> (<em>Number</em>) &#8211; Error code defined in <tt class="docutils literal"><span class="pre">turbo.websocket.errors</span></tt>.</li>
<li><strong>reason</strong> (<em>String</em>) &#8211; String representation of error.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="on_ping">
<tt class="descname">on_ping</tt><big>(</big><em>self</em>, <em>data</em><big>)</big><a class="headerlink" href="#on_ping" title="Permalink to this definition">¶</a></dt>
<dd><p>Called when a ping request is recieved.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>self</strong> (<em>turbo.websocket.WebSocketClient</em>) &#8211; The WebSocketClient instance calling the callback.</li>
<li><strong>data</strong> (<em>String</em>) &#8211; The ping payload data.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="ioloop.html" class="btn btn-neutral float-right" title="turbo.ioloop – Main I/O Loop">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="async.html" class="btn btn-neutral" title="turbo.async – Asynchronous clients"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, John Abrahamsen.
    </p>
  </div>

  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'2.0.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
  
 
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-45069639-1', 'auto');
  ga('send', 'pageview');

</script>


</body>
</html>